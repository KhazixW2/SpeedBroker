# ⚙️ 配置参数手册

## 目录
- [概述](#概述)
- [数据配置 (DATA_CONFIG)](#数据配置-data_config)
- [策略配置 (STRATEGY_CONFIG)](#策略配置-strategy_config)
- [回测配置 (BACKTEST_CONFIG)](#回测配置-backtest_config)
- [分析配置 (ANALYSIS_CONFIG)](#分析配置-analysis_config)
- [全局配置](#全局配置)
- [配置组合建议](#配置组合建议)
- [高级调优](#高级调优)

---

## 概述

`config.py` 文件是整个回测系统的"控制面板"，所有参数集中在此管理。

**配置文件结构**：
```python
config.py
├── DATA_CONFIG          # 数据相关配置
├── STRATEGY_CONFIG      # 策略参数配置
├── BACKTEST_CONFIG      # 回测参数配置
├── ANALYSIS_CONFIG      # 分析输出配置
├── DEBUG_MODE           # 调试模式开关
└── LOGGING_CONFIG       # 日志配置
```

**修改原则**：
- ✅ 修改参数值
- ❌ 不要修改参数名
- ❌ 不要删除参数
- ✅ 可以添加新参数（需代码支持）

---

## 数据配置 (DATA_CONFIG)

### 完整配置示例

```python
DATA_CONFIG = {
    'tickers': ['000001.SZ'],
    'start_date': '2023-01-01',
    'end_date': '2024-10-01',
    'data_source': 'yfinance',
    'use_cache': True,
    'cache_dir': './data/cache',
}
```

---

### `tickers` - 股票代码列表

**作用**：指定要回测的股票代码

**数据类型**：列表 (List)

**格式规范**：
```python
# A股代码格式
'000001.SZ'  # 深圳证券交易所
'600000.SH'  # 上海证券交易所

# 港股代码格式
'0700.HK'    # 腾讯控股

# 美股代码格式
'AAPL'       # 苹果
'TSLA'       # 特斯拉
```

**可选值**：任意有效的股票代码

**常用示例**：
```python
# 单只股票（推荐）
'tickers': ['000001.SZ']

# 多只股票（当前版本只会处理第一只）
'tickers': ['000001.SZ', '600519.SH']
```

**影响**：
- ✅ 决定回测哪只股票
- ⚠️ 当前版本一次只支持单只股票
- ⚠️ 股票代码错误会导致无法获取数据

**注意事项**：
- 深圳股票以 `.SZ` 结尾
- 上海股票以 `.SH` 结尾
- 代码必须存在且有交易数据
- 退市股票可能无法获取数据

---

### `start_date` - 回测开始日期

**作用**：回测的起始日期

**数据类型**：字符串 (String)

**格式**：`'YYYY-MM-DD'`

**可选值**：任意有效日期

**范围建议**：
- 最短：3个月（数据太少可能不准确）
- 推荐：1-3年（足够验证策略）
- 最长：10年以上（需考虑市场环境变化）

**示例**：
```python
'start_date': '2020-01-01'  # 从2020年开始
'start_date': '2023-01-01'  # 从2023年开始
```

**影响**：
- ✅ 决定回测的历史数据范围
- ⚠️ 时间跨度太短可能过拟合
- ⚠️ 时间跨度太长可能包含不同市场环境

**与其他参数的关系**：
- 必须早于 `end_date`
- 影响策略的样本量
- 影响均线等指标的计算

---

### `end_date` - 回测结束日期

**作用**：回测的终止日期

**数据类型**：字符串 (String)

**格式**：`'YYYY-MM-DD'`

**可选值**：任意有效日期

**建议**：
```python
# 回测历史数据
'end_date': '2024-10-01'

# 回测到最新数据
'end_date': '2024-12-31'
```

**影响**：
- ✅ 决定回测的数据截止点
- ⚠️ 设置为未来日期无效
- ⚠️ 必须晚于 `start_date`

---

### `data_source` - 数据源

**作用**：选择股票数据的来源

**数据类型**：字符串 (String)

**可选值**：
| 值 | 说明 | 推荐度 | 特点 |
|----|------|--------|------|
| `'yfinance'` | Yahoo Finance | ⭐⭐⭐⭐⭐ | 稳定、全球市场、免费 |
| `'akshare'` | AkShare | ⭐⭐⭐ | 国内数据、免费、偶尔不稳定 |

**示例**：
```python
# 推荐：使用 yfinance（更稳定）
'data_source': 'yfinance'

# 备选：使用 akshare
'data_source': 'akshare'
```

**影响**：
- ✅ 决定数据的来源和质量
- ⚠️ 不同数据源可能有细微差异
- ⚠️ akshare近期可能返回空数据

**选择建议**：
- **优先使用 yfinance**（当前默认）
- akshare作为备选方案
- 如果需要中国特定数据，使用akshare

---

### `use_cache` - 是否使用缓存

**作用**：控制是否缓存下载的数据

**数据类型**：布尔值 (Boolean)

**可选值**：
- `True` - 启用缓存（推荐）
- `False` - 禁用缓存

**默认值**：`True`

**示例**：
```python
# 启用缓存（推荐）
'use_cache': True

# 禁用缓存（每次重新下载）
'use_cache': False
```

**影响**：
- ✅ `True`：首次运行慢，后续快速
- ⚠️ `False`：每次都重新下载（慢）
- 💾 缓存文件存储在 `cache_dir` 指定的目录

**使用场景**：
- **日常使用**：`True`（节省时间）
- **需要最新数据**：删除缓存后设为`True`
- **调试数据问题**：设为`False`

---

### `cache_dir` - 缓存目录

**作用**：指定数据缓存的存储位置

**数据类型**：字符串 (String)

**格式**：相对或绝对路径

**默认值**：`'./data/cache'`

**示例**：
```python
# 相对路径（推荐）
'cache_dir': './data/cache'

# 绝对路径
'cache_dir': 'D:/backtest_data/cache'

# 其他相对路径
'cache_dir': '../shared_cache'
```

**影响**：
- 📁 决定缓存文件的存储位置
- 💾 多项目可共享缓存目录

**文件命名规则**：
```
{股票代码}_{开始日期}_{结束日期}_{数据源}.pkl
示例: 000001.SZ_20230101_20241001_yfinance.pkl
```

---

## 策略配置 (STRATEGY_CONFIG)

### 完整配置示例

```python
STRATEGY_CONFIG = {
    'strategy_name': 'DualMovingAverage',
    'short_window': 10,
    'long_window': 30,
    'rsi_period': 14,
    'rsi_oversold': 30,
    'rsi_overbought': 70,
}
```

---

### `strategy_name` - 策略名称

**作用**：选择使用哪种交易策略

**数据类型**：字符串 (String)

**可选值**：
| 策略名称 | 说明 | 适用场景 |
|----------|------|----------|
| `'DualMovingAverage'` | 双均线策略 | 趋势市场 |
| `'RSI'` | RSI策略 | 震荡市场 |

**默认值**：`'DualMovingAverage'`

**示例**：
```python
# 双均线策略（默认）
'strategy_name': 'DualMovingAverage'

# RSI策略
'strategy_name': 'RSI'
```

**影响**：
- ✅ 决定使用哪套交易规则
- ⚠️ 不同策略适用于不同市场环境
- ⚠️ 必须是已实现的策略名称

---

### 双均线策略参数

#### `short_window` - 短期均线周期

**作用**：短期移动平均线的天数

**数据类型**：整数 (Integer)

**可选范围**：5 - 60 天

**推荐值**：
- 激进：5-10天
- 中性：10-20天
- 保守：20-30天

**默认值**：`10`

**示例**：
```python
'short_window': 5   # 激进，信号频繁
'short_window': 10  # 平衡（推荐）
'short_window': 20  # 保守，信号较少
```

**影响**：
- ✅ 越小，对价格变化越敏感
- ⚠️ 太小容易产生假信号
- ⚠️ 太大反应迟钝，错过机会

**与其他参数的关系**：
- 必须 < `long_window`
- 推荐 `long_window / short_window >= 2`

---

#### `long_window` - 长期均线周期

**作用**：长期移动平均线的天数

**数据类型**：整数 (Integer)

**可选范围**：20 - 200 天

**推荐值**：
- 激进：20-30天
- 中性：30-60天
- 保守：60-120天

**默认值**：`30`

**示例**：
```python
'long_window': 20   # 短线交易
'long_window': 30   # 中线交易（推荐）
'long_window': 60   # 长线交易
'long_window': 120  # 超长线交易
```

**影响**：
- ✅ 越大，趋势判断越稳定
- ⚠️ 太大反应慢，收益可能降低
- ⚠️ 太小可能频繁交易

**经典组合**：
```python
# 快速响应
short_window=5, long_window=20

# 平衡型（推荐）
short_window=10, long_window=30

# 稳健型
short_window=20, long_window=60

# 超长线
short_window=30, long_window=120
```

---

### RSI策略参数

#### `rsi_period` - RSI计算周期

**作用**：RSI指标的计算天数

**数据类型**：整数 (Integer)

**可选范围**：5 - 30 天

**推荐值**：14天（标准值）

**默认值**：`14`

**示例**：
```python
'rsi_period': 14  # 标准（推荐）
'rsi_period': 9   # 更敏感
'rsi_period': 21  # 更平滑
```

**影响**：
- ✅ 越小，对价格变化越敏感
- ⚠️ 太小容易产生错误信号

---

#### `rsi_oversold` - RSI超卖阈值

**作用**：判断超卖（买入信号）的RSI值

**数据类型**：整数 (Integer)

**可选范围**：20 - 40

**推荐值**：30（标准值）

**默认值**：`30`

**示例**：
```python
'rsi_oversold': 20  # 严格，信号少但准确
'rsi_oversold': 30  # 标准（推荐）
'rsi_oversold': 40  # 宽松，信号多但可能不准
```

**影响**：
- ✅ 越小，买入信号越少但越可靠
- ⚠️ 太小可能错过买入机会

---

#### `rsi_overbought` - RSI超买阈值

**作用**：判断超买（卖出信号）的RSI值

**数据类型**：整数 (Integer)

**可选范围**：60 - 80

**推荐值**：70（标准值）

**默认值**：`70`

**示例**：
```python
'rsi_overbought': 60  # 宽松，信号多
'rsi_overbought': 70  # 标准（推荐）
'rsi_overbought': 80  # 严格，信号少
```

**影响**：
- ✅ 越大，卖出信号越少但越可靠
- ⚠️ 太大可能错过卖出时机

---

## 回测配置 (BACKTEST_CONFIG)

### 完整配置示例

```python
BACKTEST_CONFIG = {
    'initial_capital': 100000,
    'commission_rate': 0.0003,
    'stamp_duty_rate': 0.001,
    'slippage': 0.0001,
    'position_size': 1.0,
}
```

---

### `initial_capital` - 初始资金

**作用**：回测的起始资金量

**数据类型**：整数或浮点数 (Integer/Float)

**单位**：人民币（元）

**可选范围**：10,000 - 10,000,000

**推荐值**：
- 小资金：50,000 - 100,000
- 中等资金：100,000 - 500,000
- 大资金：500,000 - 5,000,000

**默认值**：`100000`（10万元）

**示例**：
```python
'initial_capital': 50000    # 5万元
'initial_capital': 100000   # 10万元（默认）
'initial_capital': 1000000  # 100万元
```

**影响**：
- ✅ 决定可购买的股票数量
- ⚠️ 太小可能无法分散风险
- ⚠️ 太大与实际情况脱节

**注意事项**：
- A股最小交易单位100股（1手）
- 资金太少可能买不了100股
- 建议至少能买10手以上

---

### `commission_rate` - 手续费率

**作用**：买卖股票的佣金比例

**数据类型**：浮点数 (Float)

**格式**：小数（如0.0003 = 0.03%）

**可选范围**：0.00001 - 0.003

**市场现状**：
| 账户类型 | 费率范围 | 典型值 |
|----------|----------|--------|
| 普通账户 | 0.03% - 0.1% | 0.0003 |
| VIP账户 | 0.01% - 0.02% | 0.0001 |
| 超大资金 | 0.001% - 0.008% | 0.00005 |

**默认值**：`0.0003`（万三）

**示例**：
```python
'commission_rate': 0.0003  # 万三（普通账户）
'commission_rate': 0.0001  # 万一（VIP账户）
'commission_rate': 0.00005 # 万0.5（超大资金）
```

**影响**：
- ✅ 直接影响交易成本
- ⚠️ 费率越高，收益越低
- ⚠️ 频繁交易的策略对费率更敏感

**计算方式**：
```
买入手续费 = 买入金额 × commission_rate
卖出手续费 = 卖出金额 × commission_rate
```

---

### `stamp_duty_rate` - 印花税率

**作用**：A股卖出时的印花税

**数据类型**：浮点数 (Float)

**法定税率**：0.001（0.1%）

**默认值**：`0.001`

**示例**：
```python
# A股标准印花税（不可修改）
'stamp_duty_rate': 0.001

# 港股、美股无印花税
'stamp_duty_rate': 0
```

**影响**：
- ✅ 仅在卖出时收取
- ⚠️ A股强制税率，不可调整
- ⚠️ 增加卖出成本约0.1%

**适用范围**：
- A股（深圳、上海）：必须设为0.001
- 港股：通常为0
- 美股：没有印花税，设为0

---

### `slippage` - 滑点

**作用**：实际成交价与期望价的偏差

**数据类型**：浮点数 (Float)

**格式**：小数（如0.0001 = 0.01%）

**可选范围**：0 - 0.01

**推荐值**：
| 市场环境 | 滑点设置 |
|----------|----------|
| 高流动性大盘股 | 0.0001 (0.01%) |
| 一般股票 | 0.0005 (0.05%) |
| 小盘股/冲击成本大 | 0.001 (0.1%) |

**默认值**：`0.0001`

**示例**：
```python
'slippage': 0.0001  # 0.01%（推荐）
'slippage': 0.0005  # 0.05%
'slippage': 0.001   # 0.1%（保守）
```

**影响**：
- ✅ 模拟真实市场的价格滑动
- ⚠️ 买入时价格上浮，卖出时价格下降
- ⚠️ 滑点越大，回测越保守

**计算方式**：
```
实际买入价 = 收盘价 × (1 + slippage)
实际卖出价 = 收盘价 × (1 - slippage)
```

---

### `position_size` - 仓位比例

**作用**：每次交易使用的资金占比

**数据类型**：浮点数 (Float)

**可选范围**：0.1 - 1.0

**推荐值**：
| 风险偏好 | 仓位设置 | 说明 |
|----------|----------|------|
| 激进 | 1.0 | 全仓，风险高 |
| 平衡 | 0.7 | 七成仓，留有余地 |
| 保守 | 0.5 | 半仓，风险控制 |
| 超保守 | 0.3 | 三成仓，极度保守 |

**默认值**：`1.0`（全仓）

**示例**：
```python
'position_size': 1.0  # 全仓
'position_size': 0.7  # 七成仓（推荐）
'position_size': 0.5  # 半仓
```

**影响**：
- ✅ 控制风险暴露
- ⚠️ 仓位越大，收益和风险越大
- ⚠️ 仓位越小，收益越保守

**使用建议**：
- 新手：0.5 - 0.7
- 有经验：0.7 - 1.0
- 测试策略：1.0（看最大潜力）

---

## 分析配置 (ANALYSIS_CONFIG)

### 完整配置示例

```python
ANALYSIS_CONFIG = {
    'risk_free_rate': 0.03,
    'benchmark': '000300.SH',
    'output_dir': './output',
    'save_plots': True,
}
```

---

### `risk_free_rate` - 无风险利率

**作用**：计算夏普比率的基准利率

**数据类型**：浮点数 (Float)

**格式**：年化收益率（如0.03 = 3%）

**参考值**：
| 品种 | 利率 | 适用 |
|------|------|------|
| 一年期定期存款 | 0.015 - 0.02 | 保守 |
| 三年期国债 | 0.025 - 0.03 | 标准 |
| 货币基金 | 0.02 - 0.025 | 一般 |

**默认值**：`0.03`（3%）

**示例**：
```python
'risk_free_rate': 0.02   # 2%
'risk_free_rate': 0.03   # 3%（推荐）
'risk_free_rate': 0.04   # 4%
```

**影响**：
- ✅ 影响夏普比率的计算
- ⚠️ 设置越高，夏普比率越低
- 💡 建议设为当前的国债收益率

---

### `benchmark` - 基准指数

**作用**：用于对比的市场基准

**数据类型**：字符串 (String)

**常用基准**：
| 代码 | 名称 | 适用 |
|------|------|------|
| `'000300.SH'` | 沪深300 | A股大盘 |
| `'000001.SH'` | 上证指数 | 上海市场 |
| `'399001.SZ'` | 深证成指 | 深圳市场 |
| `'399006.SZ'` | 创业板指 | 创业板 |

**默认值**：`'000300.SH'`（沪深300）

**示例**：
```python
'benchmark': '000300.SH'  # 沪深300
'benchmark': '000001.SH'  # 上证指数
'benchmark': '399001.SZ'  # 深证成指
```

**影响**：
- ℹ️ 当前版本未使用此参数
- 🔮 未来版本将实现策略与基准对比

---

### `output_dir` - 输出目录

**作用**：图表和报告的保存位置

**数据类型**：字符串 (String)

**默认值**：`'./output'`

**示例**：
```python
'output_dir': './output'           # 默认
'output_dir': './results'          # 自定义
'output_dir': 'D:/backtest/output' # 绝对路径
```

**影响**：
- 📁 决定文件保存位置
- 💾 目录不存在会自动创建

---

### `save_plots` - 是否保存图表

**作用**：控制是否保存图表到文件

**数据类型**：布尔值 (Boolean)

**可选值**：
- `True` - 保存图表（推荐）
- `False` - 不保存，只显示

**默认值**：`True`

**示例**：
```python
'save_plots': True   # 保存图表
'save_plots': False  # 不保存
```

**影响**：
- ✅ `True`：生成PNG文件，方便保存记录
- ⚠️ `False`：只显示，关闭后丢失

---

## 全局配置

### `DEBUG_MODE` - 调试模式

**作用**：启用调试信息输出

**数据类型**：布尔值 (Boolean)

**可选值**：
- `True` - 启用调试（显示详细错误信息）
- `False` - 关闭调试（推荐）

**默认值**：`False`

**示例**：
```python
DEBUG_MODE = False  # 正常使用
DEBUG_MODE = True   # 排查问题时启用
```

**影响**：
- 🐛 `True`：出错时显示完整堆栈跟踪
- ✅ `False`：只显示友好的错误消息

---

### `LOGGING_CONFIG` - 日志配置

**作用**：配置日志记录行为

**数据类型**：字典 (Dictionary)

**配置项**：
```python
LOGGING_CONFIG = {
    'level': 'INFO',
    'format': '%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    'file': './logs/backtest.log',
}
```

**日志级别**：
| 级别 | 说明 | 适用 |
|------|------|------|
| `'DEBUG'` | 最详细 | 开发调试 |
| `'INFO'` | 一般信息 | 日常使用（推荐） |
| `'WARNING'` | 警告 | 只记录问题 |
| `'ERROR'` | 错误 | 只记录错误 |

**影响**：
- ℹ️ 当前版本未完全实现日志功能
- 🔮 未来版本将支持详细日志记录

---

## 配置组合建议

### 场景 1: 新手测试

```python
DATA_CONFIG = {
    'tickers': ['000001.SZ'],
    'start_date': '2023-01-01',
    'end_date': '2024-10-01',
    'data_source': 'yfinance',
}

STRATEGY_CONFIG = {
    'strategy_name': 'DualMovingAverage',
    'short_window': 10,
    'long_window': 30,
}

BACKTEST_CONFIG = {
    'initial_capital': 100000,
    'commission_rate': 0.0003,
    'position_size': 0.7,  # 七成仓，更安全
}
```

### 场景 2: 激进短线

```python
STRATEGY_CONFIG = {
    'short_window': 5,   # 更快响应
    'long_window': 20,
}

BACKTEST_CONFIG = {
    'commission_rate': 0.0001,  # 需要更低费率
    'position_size': 1.0,       # 全仓
}
```

### 场景 3: 保守长线

```python
STRATEGY_CONFIG = {
    'short_window': 20,  # 更慢响应
    'long_window': 60,
}

BACKTEST_CONFIG = {
    'position_size': 0.5,  # 半仓
}
```

### 场景 4: 大资金账户

```python
BACKTEST_CONFIG = {
    'initial_capital': 5000000,  # 500万
    'commission_rate': 0.00005,  # 万0.5
    'slippage': 0.0005,          # 更大滑点
}
```

---

## 高级调优

### 参数优化流程

1. **基准测试**
```python
# 使用默认参数跑一次
short_window=10, long_window=30
# 记录结果作为基准
```

2. **单参数调优**
```python
# 测试不同short_window
(5, 30), (10, 30), (15, 30), (20, 30)
# 选择最佳的short_window

# 测试不同long_window
(10, 20), (10, 30), (10, 40), (10, 60)
# 选择最佳的long
